package com.blackbirdsoftware.exploitdb;

import android.content.Context;
import android.support.v7.widget.RecyclerView;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;

import com.blackbirdsoftware.exploitdb.model.Exploit;

import org.joda.time.DateTime;
import org.joda.time.format.DateTimeFormat;
import org.joda.time.format.DateTimeFormatter;

import java.util.List;

/**
 * Created by danielftapiar on 13-Apr-17.
 */

public class HomeAdapterRecycler extends RecyclerView.Adapter<HomeAdapterRecycler.ViewHolder>  {

    public interface  onItemClickListener{
        void onItemClick(Exploit item);
    }

    private List<Exploit> exploits;
    private Context context;
    private onItemClickListener listener;




    public static class ViewHolder extends RecyclerView.ViewHolder {
        // each data item is just a string in this case
        public TextView authorTextView;
        public TextView descriptionTextView;
        public TextView dateTextView;

        public ViewHolder(View itemView){
            super(itemView);
            this.authorTextView = (TextView) itemView.findViewById(R.id.recyclerViewElementAuthor);
            this.descriptionTextView = (TextView) itemView.findViewById(R.id.recyclerViewElementDescription);
            this.dateTextView = (TextView) itemView.findViewById(R.id.recyclerViewElementPublishDate);

        }

        public void bind(final Exploit exploit, final onItemClickListener listener){
            itemView.setOnClickListener(new View.OnClickListener(){
                @Override
                public void onClick(View v){
                    listener.onItemClick(exploit);
                }
            });
        }
    }

    public HomeAdapterRecycler(Context context , List<Exploit> exploits, onItemClickListener listener) {
        this.exploits = exploits;
        this.context = context;
        this.listener = listener;
    }

    public Context getContext() {
        return context;
    }

    public void setContext(Context context) {
        this.context = context;
    }

    @Override
    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        // create a new view
        Context context = parent.getContext();
        LayoutInflater inflater = LayoutInflater.from(context);

        View exploitRow = inflater.inflate(R.layout.recycler_element, parent,false);
        ViewHolder viewHolder = new ViewHolder(exploitRow);
        return viewHolder;
    }

    @Override
    public void onBindViewHolder(ViewHolder viewHolder, int position) {
        Exploit exploit = this.exploits.get(position);

        TextView authorTextView = viewHolder.authorTextView;
        authorTextView.setText(exploit.getAuthor());

        TextView descriptionTextView = viewHolder.descriptionTextView;
        descriptionTextView.setText(exploit.getAuthor());

        TextView dateTextView = viewHolder.dateTextView;
        DateTime dateTime = new DateTime(exploit.get_date());
        DateTimeFormatter dtf = DateTimeFormat.forPattern("MM/dd/yyyy");
        dateTextView.setText(dtf.print(dateTime));
        viewHolder.bind(this.exploits.get(position), listener);

    }

    @Override
    public int getItemCount() {
        if(this.exploits == null)
            return 0;
        return this.exploits.size();
    }
}
