var express = require('express');
var router  = express.Router();
var passport = require('passport');

router.get('/login', (req, res) => {
    res.json({"msg": "send username and password"});
});

router.post('/login',
  passport.authenticate('json', { failureRedirect: '/api/v1/users/login' }),
  (req, res) => {
    res.json({msg: "Logged in"});
  });

router.get('/logout',
  (req, res) =>{
    req.logout();
    res.redirect('/api/v1/users/login');
  });

router.get('/profile',
  require('connect-ensure-login').ensureLoggedIn(),
  (req, res) => {
    res.json({ user: req.user });
  });

router.post('/signup', passport.authenticate('signup', {
    successRedirect: '/api/v1/users/profile',
    failureRedirect: '/api/v1/users/login'
}));

module.exports = router;
